{% extends "base.html" %}
{% load custom_filters %}  <!-- ì»¤ìŠ¤í…€ í•„í„° ë¡œë“œ -->

{% block content %}
    <h2>{{ post.title }}</h2>
    <p>ì‘ì„±ì: {{ post.author.nickname }}
        {% if request.user.is_authenticated and request.user != post.author %}
            <form method="post" action="{% url 'follow_toggle' post.author.id %}" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="{% if is_following %}unfollow-button{% else %}follow-button{% endif %}">
                    {% if is_following %}ì–¸íŒ”ë¡œìš°{% else %}íŒ”ë¡œìš°{% endif %}
                </button>
            </form>
        {% endif %}
    </p>
    <!-- ì´ë¯¸ì§€ í‘œì‹œ ë¶€ë¶„ ì¶”ê°€ -->
    {% if post.image %}
    <div class="post-image">
        <img src="{{ post.image.url }}" alt="ê²Œì‹œê¸€ ì´ë¯¸ì§€" style="max-width: 100%; margin: 10px 0;">
    </div>
    {% endif %}

    
    <p>{{ post.content }}</p>
    <p>ì‘ì„±ì¼: {{ post.created_at }}</p>

    {% if post.author == request.user %}
        <a href="{% url 'post_update' post.id %}">ìˆ˜ì •</a>
        <form method="POST" action="{% url 'post_delete' post.id %}" style="display:inline;">
            {% csrf_token %}
            <button type="submit">ì‚­ì œ</button>
        </form>
    {% endif %}

    <!-- ë¶ë§ˆí¬ -->
    {% if user.is_authenticated %}
    <form method="POST" action="{% url 'bookmark_toggle' post.id %}" style="display:inline;">
        {% csrf_token %}
        <button type="submit" class="{% if user in post.bookmarked_by.all %}bookmark-active{% else %}bookmark{% endif %}">
            {% if user in post.bookmarked_by.all %}
                â­ ë¶ë§ˆí¬ ì·¨ì†Œ
            {% else %}
                â˜† ë¶ë§ˆí¬
            {% endif %}
        </button>
    </form>
    {% endif %}


    <h3>ì¢‹ì•„ìš”/ì‹«ì–´ìš”</h3>
    <p>ğŸ‘ ì¢‹ì•„ìš”: {{ post_likes }} | ğŸ‘ ì‹«ì–´ìš”: {{ post_dislikes }}</p>

    <form method="POST" action="{% url 'like_dislike_post' post.id %}">
        {% csrf_token %}
        <button type="submit" name="value" value="1">ğŸ‘ ì¢‹ì•„ìš”</button>
        <button type="submit" name="value" value="-1">ğŸ‘ ì‹«ì–´ìš”</button>
    </form>

    <h3>ëŒ“ê¸€</h3>
    <form method="POST" action="{% url 'add_comment' post.id %}">
        {% csrf_token %}
        <textarea name="content" required></textarea>
        <button type="submit">ëŒ“ê¸€ ì‘ì„±</button>
    </form>

    {% for comment in comments %}
        <p>{{ comment.author.nickname }}: {{ comment.content }}</p>
        <p>ğŸ‘ ì¢‹ì•„ìš”: {{ comment_reactions|get_item:comment.id|get_item:"likes" }} | ğŸ‘ ì‹«ì–´ìš”: {{ comment_reactions|get_item:comment.id|get_item:"dislikes" }}</p>

        <form method="POST" action="{% url 'like_dislike_comment' comment.id %}">
            {% csrf_token %}
            <button type="submit" name="value" value="1">ğŸ‘</button>
            <button type="submit" name="value" value="-1">ğŸ‘</button>
        </form>
    {% endfor %}

    <!-- íƒœê·¸ í‘œì‹œ -->
    {% if post.tags.all %}
    <div class="mt-3">
        <h5>íƒœê·¸:</h5>
        <div>
            {% for tag in post.tags.all %}
            <a href="{% url 'tag_posts' tag.name %}" class="badge bg-primary me-1">{{ tag.name }}</a>
            {% endfor %}
        </div>
    </div>
    {% endif %}



{% endblock %}

{% block styles %}
<style>
    .follow-button {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 3px 8px;
        border-radius: 3px;
        cursor: pointer;
    }
    
    .unfollow-button {
        background-color: #dc3545;
        color: white;
        border: none;
        padding: 3px 8px;
        border-radius: 3px;
        cursor: pointer;
    }
</style>
{% endblock %}